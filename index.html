
<!DOCTYPE html>
<html lang="ko" data-version="v12.1">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>ğŸ³ ìœ íŠœë¸Œ ë ˆì‹œí”¼</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="ìœ íŠœë¸Œ ì‡¼ì¸  ë ˆì‹œí”¼ë¥¼ ê°„í¸í•˜ê²Œ ì €ì¥í•˜ê³  ê²€ìƒ‰í•˜ì„¸ìš”" />
  <link rel="icon" href="./icon-192x192.png" />
  <link rel="apple-touch-icon" href="./icon-192x192.png" />
  <style>
    :root { --ink:#111827; --muted:#6b7280; --pri:#2563eb; --soft:#f8fafc; --fav:#374151; }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,ui-rounded,'Noto Sans KR',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
    .container{max-width:1000px;margin:0 auto;background:rgba(255,255,255,.95);backdrop-filter:blur(15px);border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden}
    .header{background:linear-gradient(135deg,#2563eb,#3b82f6);color:#fff;padding:26px 16px;text-align:center;position:relative}
    .header h1{font-size:2em;margin-bottom:6px;text-shadow:0 2px 4px rgba(0,0,0,.3)}
    .header p{opacity:.95;font-size:.95em}
    .main-content{padding:20px}
    .add-section{background:linear-gradient(135deg,#f8fafc,#e2e8f0);border-radius:15px;padding:12px;margin-bottom:12px;border:1px solid #e2e8f0;transition:.3s ease all}
    .url-input-container{position:relative;margin-bottom:8px}
    .url-input{width:100%;padding:10px 116px 10px 12px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;transition:all .3s ease}
    .url-input:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.1)}
    .add-btn{position:absolute;right:6px;top:50%;transform:translateY(-50%);background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;transition:all .2s ease;font-size:14px}
    .add-btn:hover{transform:translateY(-50%) translateY(-1px)}
    .add-btn:disabled{background:#9ca3af;cursor:not-allowed;transform:translateY(-50%)}
    .loading{display:none;text-align:center;color:#6b7280;margin-top:6px}
    .toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap}
    .left-tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .tool-btn{background:#111827;color:#fff;border:none;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:800}
    .tool-btn.secondary{background:#e5e7eb;color:#111827}
    .tool-btn.toggled{box-shadow:inset 0 0 0 2px #111827}
    .sort-select{border:2px solid #e5e7eb;border-radius:999px;padding:8px 12px;background:#fff;font-weight:800}
    .search-section{background:linear-gradient(135deg,#f8fafc,#e2e8f0);border-radius:15px;padding:12px;margin-bottom:12px;border:1px solid #e2e8f0}
    .search-title{margin:0 0 8px 2px;color:#374151;font-weight:800;font-size:1rem}
    .search-container{position:relative;max-width:650px;margin:0 auto}
    .search-input{width:100%;padding:10px 116px 10px 12px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;transition:all .3s ease}
    .search-input:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.1)}
    .clear-btn{position:absolute;right:84px;top:50%;transform:translateY(-50%);background:transparent;border:none;font-size:18px;cursor:pointer;color:#6b7280}
    .search-btn{position:absolute;right:6px;top:50%;transform:translateY(-50%);background:#111827;color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:800}
    .top-viewed-wrap{margin:4px 0 14px}
    .top-viewed-title{font-weight:800;color:#374151;margin:0 0 6px 2px}
    .top-viewed{padding:8px 12px;background:rgba(255,255,255,.55);border-radius:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#374151;font-weight:700}
    .top-viewed .sep{opacity:.6;margin:0 .5rem}
    .top-link{appearance:none;background:none;border:none;color:#111827;font-weight:800;cursor:pointer;padding:0;margin:0;display:inline;white-space:nowrap}
    .top-link:hover{text-decoration:underline}
    .top-link:focus{outline:2px solid #2563eb;outline-offset:2px;border-radius:4px}
    .views{color:var(--muted);font-weight:700;margin-left:.25rem}
    .placeholder{opacity:.5}
    .recipes-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:16px}
    .recipe-card{background:#fff;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,.1);overflow:hidden;transition:all .2s ease;border:1px solid #e2e8f0;position:relative}
    .recipe-card:hover{transform:translateY(-3px);box-shadow:0 10px 24px rgba(0,0,0,.15)}
    .recipe-thumbnail{width:100%;height:200px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;font-size:48px;position:relative;overflow:hidden}
    .recipe-thumbnail img{width:100%;height:100%;object-fit:cover}
    .play-overlay{position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,.75);color:#fff;padding:8px 12px;border-radius:999px;display:flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;backdrop-filter:saturate(180%) blur(8px)}
    .fav-btn{position:absolute;top:12px;right:12px;background:rgba(255,255,255,.9);border:none;border-radius:999px;padding:8px 10px;cursor:pointer;font-size:16px;box-shadow:0 2px 6px rgba(0,0,0,.2)}
    .fav-btn.active{background:#ffe8a3}
    .recipe-content{padding:16px}
    .recipe-title{font-size:1.05em;font-weight:800;color:#1f2937;margin-bottom:8px;line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .recipe-date{color:#6b7280;font-size:13px;margin-bottom:12px}
    .recipe-actions{display:flex;gap:8px;align-items:center}
    .yt-btn{flex:1;background:#111827;color:#fff;padding:10px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:700;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:8px}
    .share-btn{background:#f3f4f6;color:#111827;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    .delete-btn{background:#f3f4f6;color:#6b7280;border:none;padding:10px;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .delete-btn:hover{background:#ef4444;color:#fff}
    .delete-btn.nohover:hover{background:#f3f4f6;color:#6b7280}
    .no-results{text-align:center;padding:36px 16px;color:#6b7280;font-size:1.05em}
    .player-view{position:fixed;inset:0;background:#000;color:#fff;z-index:50;display:none;flex-direction:column}
    .player-view.show{display:flex}
    .pv-body{flex:1;display:flex;align-items:center;justify-content:center;padding:0 0 env(safe-area-inset-bottom) 0}
    .pv-iframe-wrap{width:100%;max-width:900px;aspect-ratio:9/16;background:#000}
    .pv-iframe-wrap iframe{width:100%;height:100%;border:0}
    .pv-footer{position:absolute;left:0;right:0;bottom:calc(env(safe-area-inset-bottom) + 28px);display:flex;gap:12px;justify-content:center;padding:0 16px;background:linear-gradient(to top,rgba(0,0,0,.6),rgba(0,0,0,0))}
    .pv-btn{background:var(--fav);color:#fff;border:none;border-radius:999px;padding:14px 20px;font-weight:900;cursor:pointer;font-size:16px}
    .pv-btn:active{transform:scale(.98)}
    .install-mask{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);display:none;z-index:60}
    .install-mask.show{display:block}
    .install-card{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(92vw,520px);background:#fff;border-radius:16px;box-shadow:0 12px 32px rgba(0,0,0,.25);padding:16px}
    .install-card h3{margin-bottom:8px;font-size:1.05rem;color:#111827}
    .install-card p{color:#374151;line-height:1.45;margin:6px 0}
    .install-actions{display:flex;justify-content:flex-end;margin-top:12px}
    .btn{background:#111827;color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
    .btn.secondary{background:#e5e7eb;color:#111827}
    .err-banner{position:fixed;left:0;right:0;top:0;background:#fee2e2;color:#991b1b;padding:10px 14px;font-weight:800;z-index:1000;display:none}
    .err-banner.show{display:block}
    @media (max-width:768px){
      body{padding:10px}
      .header{padding:18px}
      .main-content{padding:16px}
      .recipes-grid{grid-template-columns:1fr}
      .pv-btn{font-size:15px;padding:13px 18px}
      .pv-footer{bottom:calc(env(safe-area-inset-bottom) + 24px)}
    }
  </style>
</head>
<body>
  <div id="err" class="err-banner"></div>
  <div class="container">
    <div class="header">
      <h1>ğŸ³ ìœ íŠœë¸Œ ë ˆì‹œí”¼</h1>
      <p>ì£¼ì†Œì¶”ê°€â†’ ê²€ìƒ‰â†’ ì˜ìƒ í´ë¦­</p>
    </div>
    <div class="main-content">
      <div class="toolbar">
        <div class="left-tools">
          <button id="fav-filter" class="tool-btn secondary" aria-pressed="false" type="button">â­ ì¦ê²¨ì°¾ê¸°ë§Œ</button>
          <select id="sort-select" class="sort-select" aria-label="ì •ë ¬">
            <option value="latest" selected>ìµœì‹ ìˆœ</option>
            <option value="most_viewed">ìì£¼ë³¸ìˆœ</option>
            <option value="favorites_first">ì¦ê²¨ì°¾ê¸° ìš°ì„ </option>
          </select>
          <button id="install-inline" class="tool-btn secondary" type="button">ì•± ì„¤ì¹˜</button>
        </div>
      </div>
      <div id="add-section" class="add-section">
        <h3 style="margin-bottom:8px;color:#374151">ğŸ”— ìœ íŠœë¸Œ ë§í¬ ì¶”ê°€</h3>
        <div class="url-input-container">
          <input type="url" id="youtube-url" class="url-input" placeholder="https://youtube.com/shorts/... ë˜ëŠ” https://youtu.be/...">
          <button id="add-btn" class="add-btn" type="button">ì¶”ê°€</button>
        </div>
        <div id="loading" class="loading">â³ ì œëª©ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>
      </div>
      <div class="search-section add-section">
        <h3 class="search-title">ğŸ” ë ˆì‹œí”¼ ê²€ìƒ‰</h3>
        <div class="search-container">
          <input type="text" id="search-input" class="search-input" placeholder="ìš”ë¦¬ëª… ë˜ëŠ” #íƒœê·¸ë¡œ ê²€ìƒ‰ (ì˜ˆ: ê¹€ì¹˜, #êµ­ë¬¼, #ë³¶ìŒ)">
          <button id="clear-btn" class="clear-btn" title="ì§€ìš°ê¸°" type="button">âœ•</button>
          <button id="search-btn" class="search-btn" type="button">ê²€ìƒ‰</button>
        </div>
      </div>
      <div class="top-viewed-wrap">
        <div class="top-viewed-title">ìµœë‹¤ ì‹œì²­ ìˆœìœ„</div>
        <div id="top-viewed" class="top-viewed" title=""></div>
      </div>
      <div id="recipes-container">
        <div id="recipes-grid" class="recipes-grid"></div>
        <div id="no-results" class="no-results" style="display:none">
          ì €ì¥ëœ ë ˆì‹œí”¼ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ì—ì„œ ì£¼ì†Œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.
        </div>
      </div>
    </div>
  </div>
  <section id="player-view" class="player-view" aria-hidden="true">
    <div class="pv-body">
      <div class="pv-iframe-wrap">
        <iframe id="pv-iframe" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen referrerpolicy="strict-origin-when-cross-origin"></iframe>
      </div>
    </div>
    <div class="pv-footer">
      <button id="pv-back" class="pv-btn" type="button">ë’¤ë¡œ</button>
      <button id="pv-fav" class="pv-btn" type="button">ì¦ê²¨ì°¾ê¸°</button>
      <button id="pv-share" class="pv-btn" type="button">ê³µìœ </button>
    </div>
  </section>
  <div id="install-help" class="install-mask" role="dialog" aria-modal="true" aria-labelledby="install-title">
    <div class="install-card">
      <h3 id="install-title">ì•± ì„¤ì¹˜ ì•ˆë‚´</h3>
      <div id="install-steps"></div>
      <div class="install-actions">
        <button id="help-close" class="btn" type="button">í™•ì¸</button>
      </div>
    </div>
  </div>
  <script>
    (function(){
      window.addEventListener('error', function(e){
        var el = document.getElementById('err');
        if(!el) return;
        el.textContent = 'ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜: ' + (e.message || 'ì•Œ ìˆ˜ ì—†ìŒ');
        el.classList.add('show');
        setTimeout(function(){ el.classList.remove('show'); }, 6000);
      });
    })();
  </script>
  <script>
    console.log('ìœ íŠœë¸Œ ë ˆì‹œí”¼ loaded v12.1');
    function supportsLocalStorage(){
      try{ var t='__t__'; localStorage.setItem(t,'1'); localStorage.removeItem(t); return true; }catch(e){ return false; }
    }
    class YouTubeRecipeApp{
      constructor(){
        this.recipes=this.loadRecipes();
        this.current=null; this.onlyFav=false; this.sortMode='latest'; this.deferredPrompt=null;
        var changed=false;
        for(var i=0;i<this.recipes.length;i++){
          var r=this.recipes[i]; if(!r.tags) r.tags=[];
          if(r.tags.length===0){ var g=this.generateTags(r.title||''); if(g.length){ r.tags=g; changed=true; } }
        }
        if(changed) this.saveRecipes();
        this.init();
      }
      init(){
        this.setupEventListeners(); this.renderRecipes(); this.updateTopViewed(); this.setupPWA();
        if(location.hash.indexOf('#play=')===0){ var id=location.hash.split('=')[1]; if(id){ var s=this; setTimeout(function(){ s.openPlayer(id); },0);}}
        if(location.hash.indexOf('#shared=')===0){ var p=decodeURIComponent(location.hash.slice('#shared='.length)); var s2=this; setTimeout(function(){ s2.handleSharedPayload(p); },0); }
        var self=this;
        window.addEventListener('hashchange', function(){
          if(location.hash.indexOf('#play=')===0){ var id=location.hash.split('=')[1]; if(id) self.openPlayer(id); }
          else if(location.hash.indexOf('#shared=')===0){ var p=decodeURIComponent(location.hash.slice('#shared='.length)); self.handleSharedPayload(p); }
          else{ var pv=document.getElementById('player-view'); if(pv.classList.contains('show')) self.closePlayer(); }
        });
      }
      setupEventListeners(){
        document.getElementById('add-btn').addEventListener('click',()=>{this.addRecipe()});
        document.getElementById('youtube-url').addEventListener('keypress',(e)=>{if(e.key==='Enter'){this.addRecipe()}});
        var searchInput=document.getElementById('search-input'); var doSearch=()=>{this.searchRecipes(searchInput.value)};
        searchInput.addEventListener('input',doSearch);
        document.getElementById('search-btn').addEventListener('click',doSearch);
        document.getElementById('clear-btn').addEventListener('click',()=>{searchInput.value='';this.renderRecipes();searchInput.focus()});
        var favBtn=document.getElementById('fav-filter');
        favBtn.addEventListener('click',()=>{ this.onlyFav=!this.onlyFav; favBtn.classList.toggle('toggled',this.onlyFav); favBtn.setAttribute('aria-pressed',String(this.onlyFav)); this.renderRecipes(searchInput.value); });
        var sortSel=document.getElementById('sort-select');
        sortSel.addEventListener('change',(e)=>{ this.sortMode=e.target.value; this.renderRecipes(searchInput.value); });
        document.getElementById('pv-back').addEventListener('click',()=>this.closePlayer());
        document.getElementById('pv-fav').addEventListener('click',()=>this.toggleFavCurrent());
        document.getElementById('pv-share').addEventListener('click',()=>this.shareCurrent());
      }
      // Tag generation same as v12
      generateTags(title){
        var t=(title||'').toLowerCase();
        var pairs=[[/êµ­ë¬¼|íƒ•|ì „ê³¨|ì°Œê°œ|ìˆ˜í”„/,'êµ­ë¬¼'],[/ë³¶ìŒ|ë³¶ë‹¤|stir|stir-fry|stir fry/,'ë³¶ìŒ'],[/êµ¬ì´|grill|ì˜¤ë¸/,'êµ¬ì´'],[/íŠ€ê¹€|ì—ì–´í”„ë¼ì´|ì—ì–´í”„ë¼ì´ì–´|air ?fry/,'íŠ€ê¹€'],[/ì „ìë ˆì¸ì§€|ë Œì§€|microwave/,'ì „ìë ˆì¸ì§€'],[/ë¹„ê±´|ì±„ì‹|vegan/,'ë¹„ê±´'],[/ê°„ë‹¨|ì´ˆê°„ë‹¨|ì‰½ê²Œ|5ë¶„|10ë¶„|í€µ/,'ê°„ë‹¨'],[/ë§¤ìš´|ë§¤ì½¤|spicy|ë§¤ìš´ë§›/,'ë§¤ìš´ë§›'],[/ê¹€ì¹˜/,'ê¹€ì¹˜'],[/ë¼ì§€|ì‚¼ê²¹|ëª©ì‚´|pork/,'ë¼ì§€ê³ ê¸°'],[/ì†Œê³ ê¸°|beef|ë“±ì‹¬|ì•ˆì‹¬|ì°¨ëŒ/,'ì†Œê³ ê¸°'],[/ë‹­|ì¹˜í‚¨|ë‹­ê°€ìŠ´|ë‹­ë‹¤ë¦¬|chicken/,'ë‹­ê³ ê¸°'],[/ê³„ë€|ë‹¬ê±€|egg/,'ê³„ë€'],[/ë‘ë¶€|tofu/,'ë‘ë¶€'],[/ë°¥|rice|ë¹„ë¹”ë°¥/,'ë°¥'],[/ë©´|íŒŒìŠ¤íƒ€|noodle|ramen|ë¼ë©´|êµ­ìˆ˜|ìš°ë™|íŒŒìŠ¤íƒ€/,'ë©´/íŒŒìŠ¤íƒ€'],[/ì°œ|steam/,'ì°œ'],[/ì „|ë¶€ì¹¨|jeon/,'ë¶€ì¹¨/ì „'],[/ì¹´ë ˆ|ì»¤ë¦¬|curry/,'ì¹´ë ˆ'],[/ìƒëŸ¬ë“œ|salad/,'ìƒëŸ¬ë“œ'],[/ë–¡ë³¶ì´/,'ë–¡ë³¶ì´'],[/ì•¼ì‹|ì•ˆì£¼|ìˆ ì•ˆì£¼/,'ìˆ ì•ˆì£¼'],[/ë„ì‹œë½|ëŸ°ì¹˜ë°•ìŠ¤|lunch/,'ë„ì‹œë½'],[/ë‹¤ì´ì–´íŠ¸|ì €íƒ„ìˆ˜|keto|ë‹¨ë°±ì§ˆ|protein/,'ë‹¤ì´ì–´íŠ¸'],[/ë””ì €íŠ¸|ë² ì´í‚¹|ì¿ í‚¤|ì¼€ì´í¬|ë¹µ|dessert|baking/,'ë””ì €íŠ¸']];
        var tags=[], i; for(i=0;i<pairs.length;i++){ if(pairs[i][0].test(t)) tags.push(pairs[i][1]); }
        var out=[], j; for(j=0;j<tags.length;j++){ if(out.indexOf(tags[j])===-1) out.push(tags[j]); } return out;
      }
      // Count external open as a "view" too
      openYouTube(id){
        var rec=this.recipes.find(function(r){return r.id===id;});
        if(rec){
          rec.views=(rec.views||0)+1;
          rec.lastViewedAt=new Date().toISOString();
          this.saveRecipes(); this.updateTopViewed();
          window.open(rec.url,'_blank','noopener');
        }
      }
      async shareRecipe(id){
        var rec=this.recipes.find(function(r){return r.id===id;});
        if(!rec) return;
        var text=rec.title+"\n"+rec.url;
        if(navigator.share){ try{ await navigator.share({title:rec.title,text:rec.title,url:rec.url}); }catch(_){}
        }else{ try{ await navigator.clipboard.writeText(text); alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); }catch(_){ } }
      }
      async addRecipe(){
        var urlInput=document.getElementById('youtube-url'); var addBtn=document.getElementById('add-btn'); var loading=document.getElementById('loading');
        var url=urlInput.value.trim(); if(!url){alert('ìœ íŠœë¸Œ ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
        if(!this.isValidYouTubeUrl(url)){alert('ì˜¬ë°”ë¥¸ ìœ íŠœë¸Œ ë§í¬ê°€ ì•„ë‹™ë‹ˆë‹¤.');return;}
        var newVid=this.extractVideoId(url); if(this.recipes.some((r)=>this.extractVideoId(r.url)===newVid)){alert('ì´ë¯¸ ì €ì¥ëœ ë ˆì‹œí”¼ì…ë‹ˆë‹¤.');return;}
        addBtn.disabled=true; loading.style.display='block';
        try{
          var title=await this.extractTitle(url);
          var videoId=this.extractVideoId(url);
          var thumbnail='https://img.youtube.com/vi/'+videoId+'/maxresdefault.jpg';
          var recipe={id:Date.now().toString(), title:title||'ì œëª©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', url:url, thumbnail:thumbnail, createdAt:new Date().toISOString(), views:0, favorite:false, tags:this.generateTags(title||'')};
          this.recipes.unshift(recipe); this.saveRecipes(); this.renderRecipes(); this.updateTopViewed(); urlInput.value='';
        }catch(err){ console.error(err); alert('ì œëª©ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); }
        finally{ addBtn.disabled=false; loading.style.display='none'; }
      }
      async handleSharedPayload(payload){
        var m=(payload||'').match(/https?:\/(?:www\.)?(?:youtube\.com\/(?:watch\?v=|shorts\/)|youtu\.be\/)[\w-]+/i);
        if(!m){ alert('ê³µìœ ëœ ë‚´ìš©ì—ì„œ ìœ íŠœë¸Œ ë§í¬ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); return; }
        var url=m[0];
        if(this.recipes.some((r)=>this.extractVideoId(r.url)===this.extractVideoId(url))){
          var ex=this.recipes.find((r)=>this.extractVideoId(r.url)===this.extractVideoId(url));
          if(ex){ this.openPlayer(ex.id); } location.hash=''; return;
        }
        try{
          var title=await this.extractTitle(url);
          var vid=this.extractVideoId(url);
          var thumbnail='https://img.youtube.com/vi/'+vid+'/maxresdefault.jpg';
          var recipe={id:Date.now().toString(), title:title||'ì œëª©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', url:url, thumbnail:thumbnail, createdAt:new Date().toISOString(), views:0, favorite:false, tags:this.generateTags(title||'')};
          this.recipes.unshift(recipe); this.saveRecipes(); this.renderRecipes(); this.updateTopViewed(); this.openPlayer(recipe.id);
        }catch(e){ console.error(e); alert('ê³µìœ ëœ ë§í¬ë¥¼ ì¶”ê°€í•˜ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); }
        finally{ location.hash=''; }
      }
      isValidYouTubeUrl(url){ var pats=[/^https?:\/\/(www\.)?youtube\.com\/shorts\/[\w-]+/,/^https?:\/\/(www\.)?youtube\.com\/watch\?v=[\w-]+/,/^https?:\/\/youtu\.be\/[\w-]+/]; return pats.some(function(p){return p.test(url);}); }
      extractVideoId(url){ var p=[/(?:youtube\.com\/shorts\/)([a-zA-Z0-9_-]+)/,/(?:youtube\.com\/watch\?v=)([a-zA-Z0-9_-]+)/,/(?:youtu\.be\/)([a-zA-Z0-9_-]+)/]; for(var i=0;i<p.length;i++){ var m=url.match(p[i]); if(m) return m[1]; } return null; }
      async extractTitle(url){ try{ var id=this.extractVideoId(url); if(!id) throw new Error('Invalid'); var r=await fetch('https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v='+id+'&format=json'); if(!r.ok) throw new Error('oEmbed failed'); var d=await r.json(); return d.title; }catch(_){ var id2=this.extractVideoId(url); return 'ìœ íŠœë¸Œ ë ˆì‹œí”¼ ('+(id2||'ì•Œ ìˆ˜ ì—†ìŒ')+')'; } }
      deleteRecipe(id,evt){ var btn=evt&&evt.currentTarget; var ok=confirm('ì •ë§ ì´ ë ˆì‹œí”¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'); if(ok){ this.recipes=this.recipes.filter(function(r){return r.id!==id;}); this.saveRecipes(); this.renderRecipes(); this.updateTopViewed(); } else if(btn){ btn.classList.add('nohover'); btn.blur(); var off=function(){ btn.classList.remove('nohover'); btn.removeEventListener('mouseleave',off); }; btn.addEventListener('mouseleave',off,{once:true}); } }
      toggleFav(id){ var r=this.recipes.find(function(x){return x.id===id;}); if(!r) return; r.favorite=!r.favorite; this.saveRecipes(); this.renderRecipes(document.getElementById('search-input').value); this.updateTopViewed(); if(this.current && this.current.id===id){ this.syncPlayerFavBtn(); } }
      toggleFavCurrent(){ if(!this.current) return; this.toggleFav(this.current.id); }
      normalize(s){ return (s||'').toLowerCase().trim(); }
      matchByQuery(r,q){ if(!q) return true; var tokens=this.normalize(q).split(/[\s,]+/).filter(Boolean); if(tokens.length===0) return true; var title=this.normalize(r.title); var tags=(r.tags||[]).map((x)=>this.normalize(x)); return tokens.every((term)=>{ var t=term.charAt(0)==='#'?term.slice(1):term; return title.indexOf(t)>-1 || tags.some((tag)=>tag.indexOf(t)>-1); }); }
      searchRecipes(q){ this.renderRecipes(q); }
      sortList(list){ var m=this.sortMode; if(m==='most_viewed'){ return list.sort(function(a,b){ return (b.views||0)-(a.views||0) || (new Date(b.lastViewedAt||0))-(new Date(a.lastViewedAt||0)) || (new Date(b.createdAt||0))-(new Date(a.createdAt||0)); }); } if(m==='favorites_first'){ return list.sort(function(a,b){ return (a.favorite===b.favorite?0:(b.favorite?1:-1)) || (new Date(b.lastViewedAt||0))-(new Date(a.lastViewedAt||0)) || (new Date(b.createdAt||0))-(new Date(a.createdAt||0)); }); } return list.sort(function(a,b){ return (new Date(b.createdAt||0))-(new Date(a.createdAt||0)); }); }
      renderRecipes(searchQuery){ if(searchQuery===undefined) searchQuery=''; var list=this.recipes.slice(); if(this.onlyFav) list=list.filter(function(r){return r.favorite;}); if(searchQuery) list=list.filter((r)=>this.matchByQuery(r,searchQuery)); list=this.sortList(list);
        var container=document.getElementById('recipes-grid'); var noResults=document.getElementById('no-results');
        if(list.length===0){ container.style.display='none'; noResults.style.display='block'; noResults.innerHTML=searchQuery?('"'+searchQuery+'"ì— ëŒ€í•œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'):'ì €ì¥ëœ ë ˆì‹œí”¼ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ì—ì„œ ì£¼ì†Œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.'; }
        else{ container.style.display='grid'; noResults.style.display='none'; var html=''; for(var i=0;i<list.length;i++){ html+=this.createRecipeCard(list[i]); } container.innerHTML=html; } }
      createRecipeCard(r){ var date=new Date(r.createdAt).toLocaleDateString('ko-KR'); var id=this.extractVideoId(r.url)||''; var favClass=r.favorite?'fav-btn active':'fav-btn'; var favLabel=r.favorite?'â­':'â˜†';
        return '<div class="recipe-card"><div class="recipe-thumbnail" onclick="app.openPlayer(\''+r.id+'\')"><img src="'+r.thumbnail+'" alt="'+r.title+'" onerror="this.onerror=null; this.src=\'https://img.youtube.com/vi/'+id+'/hqdefault.jpg\';"><button class="'+favClass+'" onclick="event.stopPropagation(); app.toggleFav(\''+r.id+'\')" aria-pressed="'+r.favorite+'" type="button">'+favLabel+'</button><div class="play-overlay">â–¶ ì¬ìƒ</div></div><div class="recipe-content"><h3 class="recipe-title" title="'+r.title.replace(/"/g,'&quot;')+'">'+r.title+'</h3><div class="recipe-date">ì €ì¥ì¼: '+date+(r.views?(' Â· ì¬ìƒ '+r.views):'')+'</div><div class="recipe-actions"><button class="yt-btn" onclick="app.openYouTube(\''+r.id+'\')" type="button">ìœ íŠœë¸Œë¡œ ë³´ê¸°</button><button class="share-btn" onclick="app.shareRecipe(\''+r.id+'\')" type="button">ê³µìœ </button><button class="delete-btn" onclick="app.deleteRecipe(\''+r.id+'\', event)" title="ì‚­ì œ" type="button">ğŸ—‘ï¸</button></div></div></div>'; }
      escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#039;'); }
      // Top viewed: always 3 slots
      updateTopViewed(){
        var el=document.getElementById('top-viewed'); if(!el) return;
        var list=this.recipes.slice();
        // Only count items with at least 1 view
        list=list.filter(function(r){ return (r.views||0)>0; });
        list.sort(function(a,b){
          var av=(a.views||0), bv=(b.views||0);
          if(bv-av!==0) return bv-av;
          var al=a.lastViewedAt?new Date(a.lastViewedAt).getTime():0;
          var bl=b.lastViewedAt?new Date(b.lastViewedAt).getTime():0;
          if(bl-al!==0) return bl-al;
          var ac=a.createdAt?new Date(a.createdAt).getTime():0;
          var bc=b.createdAt?new Date(b.createdAt).getTime():0;
          return bc-ac;
        });
        var slots=[list[0]||null, list[1]||null, list[2]||null];
        var html='';
        for(var i=0;i<3;i++){
          if(slots[i]){
            var r=slots[i];
            var title=this.escapeHtml(r.title);
            var count=r.views||0;
            html+='<button class="top-link" onclick="app.openPlayer(\''+r.id+'\')" title="'+title+'">'+(i+1)+') '+title+' <span class="views">('+count+')</span></button>';
          }else{
            html+='<span class="placeholder">'+(i+1)+')</span>';
          }
          if(i<2) html+='<span class="sep">Â·</span>';
        }
        el.innerHTML=html;
        var tip='';
        for(var j=0;j<3;j++){
          if(slots[j]) tip+=(j+1)+') '+slots[j].title+' ('+(slots[j].views||0)+')'+(j<2?' | ':'');
        }
        el.title=tip || 'ì¬ìƒ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤';
      }
      openPlayer(id){ var rec=this.recipes.find(function(r){return r.id===id;}); if(!rec) return; rec.views=(rec.views||0)+1; rec.lastViewedAt=new Date().toISOString(); this.saveRecipes(); this.updateTopViewed(); this.current=rec;
        var pv=document.getElementById('player-view'); var iframe=document.getElementById('pv-iframe'); var vid=this.extractVideoId(rec.url); var embed='https://www.youtube.com/embed/'+vid+'?autoplay=1&modestbranding=1&rel=0&playsinline=1';
        iframe.src=embed; pv.classList.add('show'); pv.setAttribute('aria-hidden','false'); history.pushState(null,'','#play='+id); document.documentElement.style.overflow='hidden'; document.body.style.overflow='hidden'; this.syncPlayerFavBtn(); }
      closePlayer(){ var pv=document.getElementById('player-view'); var iframe=document.getElementById('pv-iframe'); pv.classList.remove('show'); pv.setAttribute('aria-hidden','true'); iframe.src=''; if(location.hash.indexOf('#play=')===0){ history.pushState('', document.title, window.location.pathname + window.location.search); } document.documentElement.style.overflow=''; document.body.style.overflow=''; }
      syncPlayerFavBtn(){ var btn=document.getElementById('pv-fav'); if(!btn || !this.current) return; btn.textContent=((this.current && this.current.favorite)?'â­ ':'â˜† ')+'ì¦ê²¨ì°¾ê¸°'; }
      async shareCurrent(){ if(!this.current) return; var text=this.current.title+"\n"+this.current.url; if(navigator.share){ try{ await navigator.share({title:this.current.title,text:this.current.title,url:this.current.url}); }catch(_){ } } else { try{ await navigator.clipboard.writeText(text); alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); }catch(_){ } } }
      loadRecipes(){ if(!supportsLocalStorage()) return []; try{ var s=localStorage.getItem('youtubeRecipes'); return s?JSON.parse(s):[]; }catch(_){ return []; } }
      saveRecipes(){ if(!supportsLocalStorage()) return; try{ localStorage.setItem('youtubeRecipes', JSON.stringify(this.recipes)); }catch(e){ console.error('ì €ì¥ ì¤‘ ì˜¤ë¥˜:',e); } }
      platform(){ var ua=navigator.userAgent||navigator.vendor||window.opera||''; var isiOS=/iPad|iPhone|iPod/.test(ua)&&!window.MSStream; var isSafari=/^((?!(chrome|android)).)*safari/i.test(ua); var isAndroid=/Android/.test(ua); var isChrome=/Chrome|CriOS/.test(ua); return { isiOS:isiOS, isSafari:isSafari, isAndroid:isAndroid, isChrome:isChrome }; }
      showInstallHelp(){ var modal=document.getElementById('install-help'); var steps=document.getElementById('install-steps'); var p=this.platform(); var html=''; if(p.isiOS && p.isSafari){ html='<p>iPhone/iPad Safariì—ì„œëŠ” ì•„ë˜ ìˆœì„œë¡œ ì„¤ì¹˜í•´ìš”:</p><p>1) í™”ë©´ í•˜ë‹¨ì˜ <b>ê³µìœ </b> ë²„íŠ¼(â–¡â†‘) íƒ­</p><p>2) ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ <b>í™ˆ í™”ë©´ì— ì¶”ê°€</b> ì„ íƒ</p>'; } else if(p.isAndroid && p.isChrome){ html='<p>Android Chromeì—ì„œëŠ” ì£¼ì†Œì°½ ì˜¤ë¥¸ìª½ ë©”ë‰´(â‹®)ì—ì„œ <b>ì•± ì„¤ì¹˜</b>ë¥¼ ì„ íƒí•˜ê±°ë‚˜, ì ì‹œ ì‚¬ìš© í›„ ìë™ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ì„¤ì¹˜ ë°°ë„ˆë¥¼ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”.</p>'; } else { html='<p>ë°ìŠ¤í¬í†± ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì£¼ì†Œì°½ ìš°ì¸¡ì˜ <b>ì„¤ì¹˜ ì•„ì´ì½˜</b> ë˜ëŠ” ë¸Œë¼ìš°ì € ë©”ë‰´ì—ì„œ <b>ì•± ì„¤ì¹˜</b>ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>'; } steps.innerHTML=html; modal.classList.add('show'); var close=document.getElementById('help-close'); if(close){ close.onclick=function(){ modal.classList.remove('show'); }; } }
      setupPWA(){ var btn=document.getElementById('install-inline'); var hide=function(){ btn.style.display='none'; }; var show=function(){ btn.style.display='inline-flex'; };
        var isStandalone=(window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone===true; if(isStandalone) hide(); else show();
        var self=this; window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); self.deferredPrompt=e; show(); });
        if(btn){ btn.addEventListener('click', async ()=>{ if(self.deferredPrompt){ self.deferredPrompt.prompt(); try{ await self.deferredPrompt.userChoice; }catch(_){ } self.deferredPrompt=null; } else { self.showInstallHelp(); } }); }
        window.addEventListener('appinstalled', hide);
        if('serviceWorker' in navigator){ window.addEventListener('load', function(){ navigator.serviceWorker.register('sw.js').catch(function(err){ console.log('SW registration failed', err); }); }); }
      }
    }
    var app=new YouTubeRecipeApp();
  </script>
</body>
</html>
