
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>유튜브 레시피 북마크</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#2563eb" />
  <meta name="description" content="유튜브 쇼츠 레시피를 간편하게 저장하고 검색하세요" />
  <link rel="icon" href="./icon-192x192.png" />
  <link rel="apple-touch-icon" href="./icon-192x192.png" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,ui-rounded,'Noto Sans KR',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
    .container{max-width:1000px;margin:0 auto;background:rgba(255,255,255,.95);backdrop-filter:blur(15px);border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden}
    .header{background:linear-gradient(135deg,#2563eb,#3b82f6);color:#fff;padding:30px;text-align:center;position:relative}
    .header h1{font-size:2.5em;margin-bottom:10px;text-shadow:0 2px 4px rgba(0,0,0,.3)}
    .header p{opacity:.9;font-size:1.1em}
    .main-content{padding:30px}
    .add-section{background:linear-gradient(135deg,#f8fafc,#e2e8f0);border-radius:15px;padding:30px;margin-bottom:40px;border:1px solid #e2e8f0}
    .url-input-container{position:relative;margin-bottom:20px}
    .url-input{width:100%;padding:15px 120px 15px 20px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;transition:all .3s ease}
    .url-input:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.1)}
    .add-btn{position:absolute;right:5px;top:50%;transform:translateY(-50%);background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s ease;font-size:14px}
    .add-btn:hover{transform:translateY(-50%) translateY(-2px);box-shadow:0 4px 8px rgba(16,185,129,.3)}
    .add-btn:disabled{background:#9ca3af;cursor:not-allowed;transform:translateY(-50%)}
    .loading{display:none;text-align:center;color:#6b7280;margin-top:10px}
    .search-section{margin-bottom:30px}
    .search-container{position:relative;max-width:600px;margin:0 auto}
    .search-input{width:100%;padding:15px 50px 15px 20px;border:2px solid #e5e7eb;border-radius:50px;font-size:16px;transition:all .3s ease}
    .search-input:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.1)}
    .search-icon{position:absolute;right:20px;top:50%;transform:translateY(-50%);color:#6b7280;font-size:18px}
    .recipes-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px}
    .recipe-card{background:#fff;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,.1);overflow:hidden;transition:all .3s ease;border:1px solid #e5e7eb;position:relative}
    .recipe-card:hover{transform:translateY(-5px);box-shadow:0 12px 28px rgba(0,0,0,.15)}
    .recipe-thumbnail{width:100%;height:200px;background:linear-gradient(135deg,#f3f4f6,#e5e7eb);display:flex;align-items:center;justify-content:center;font-size:48px;position:relative;overflow:hidden}
    .recipe-thumbnail img{width:100%;height:100%;object-fit:cover}
    .play-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(255,0,0,.9);color:#fff;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;transition:all .3s ease}
    .play-overlay:hover{transform:translate(-50%,-50%) scale(1.1);background:rgba(255,0,0,1)}
    .recipe-content{padding:20px}
    .recipe-title{font-size:1.2em;font-weight:700;color:#1f2937;margin-bottom:10px;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .recipe-date{color:#6b7280;font-size:14px;margin-bottom:15px}
    .recipe-actions{display:flex;gap:10px;align-items:center}
    .watch-btn{flex:1;background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;padding:12px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:8px;transition:all .3s ease}
    .watch-btn:hover{transform:translateY(-1px);box-shadow:0 4px 8px rgba(239,68,68,.3)}
    .delete-btn{background:#f3f4f6;color:#6b7280;border:none;padding:12px;border-radius:8px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center}
    .delete-btn:hover{background:#ef4444;color:#fff}
    .no-results{text-align:center;padding:60px 20px;color:#6b7280;font-size:1.1em}
    .stats{display:flex;justify-content:center;gap:30px;margin-bottom:20px;padding:20px;background:rgba(255,255,255,.5);border-radius:12px}
    .stat-item{text-align:center}
    .stat-number{font-size:2em;font-weight:700;color:#2563eb;display:block}
    .stat-label{color:#6b7280;font-size:.9em}
    .install-prompt{background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:15px 20px;margin-bottom:20px;border-radius:10px;display:flex;justify-content:space-between;align-items:center}
    .install-btn{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);color:#fff;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600}
    .install-btn:hover{background:rgba(255,255,255,.3)}
    @media (max-width:768px){
      body{padding:10px}
      .header{padding:20px}
      .header h1{font-size:2em}
      .main-content{padding:20px}
      .add-section{padding:20px}
      .url-input{padding:15px 15px 15px 20px;margin-bottom:10px}
      .add-btn{position:static;transform:none;width:100%}
      .add-btn:hover{transform:translateY(-2px)}
      .recipes-grid{grid-template-columns:1fr}
      .stats{flex-direction:column;gap:15px}
      .stat-item{display:flex;justify-content:space-between;align-items:center}
      .stat-number{font-size:1.5em}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🍳 유튜브 레시피 북마크</h1>
      <p>유튜브 쇼츠 레시피를 간편하게 저장하고 검색하세요</p>
    </div>

    <div class="main-content">
      <!-- PWA 설치 안내 -->
      <div id="install-prompt" class="install-prompt" style="display:none">
        <div>
          <strong>📱 앱으로 설치하기</strong>
          <div>홈 화면에 추가해서 더 편리하게 이용하세요!</div>
        </div>
        <button id="install-btn" class="install-btn">설치하기</button>
      </div>

      <!-- 통계 -->
      <div class="stats">
        <div class="stat-item">
          <span id="total-count" class="stat-number">0</span>
          <span class="stat-label">저장된 레시피</span>
        </div>
        <div class="stat-item">
          <span id="today-count" class="stat-number">0</span>
          <span class="stat-label">오늘 추가</span>
        </div>
      </div>

      <!-- 레시피 추가 섹션 -->
      <div class="add-section">
        <h3 style="margin-bottom:15px;color:#374151">🔗 유튜브 링크 추가</h3>
        <div class="url-input-container">
          <input type="url" id="youtube-url" class="url-input" placeholder="https://youtube.com/shorts/... 또는 https://youtu.be/...">
          <button id="add-btn" class="add-btn">추가</button>
        </div>
        <div id="loading" class="loading">⏳ 제목을 가져오는 중...</div>
      </div>

      <!-- 검색 섹션 -->
      <div class="search-section">
        <div class="search-container">
          <input type="text" id="search-input" class="search-input" placeholder="레시피 제목으로 검색하세요... (예: 김치, 볶음, 전자렌지)">
          <span class="search-icon">🔍</span>
        </div>
      </div>

      <!-- 레시피 목록 -->
      <div id="recipes-container">
        <div id="recipes-grid" class="recipes-grid"></div>
        <div id="no-results" class="no-results" style="display:none">
          아직 저장된 레시피가 없습니다.<br>위에서 유튜브 링크를 추가해보세요! 🎬
        </div>
      </div>
    </div>
  </div>

  <script>
    class YouTubeRecipeApp{
      constructor(){
        this.recipes=this.loadRecipes();
        this.init();
      }
      init(){
        this.setupEventListeners();
        this.renderRecipes();
        this.updateStats();
        this.setupPWA();
      }
      setupEventListeners(){
        document.getElementById('add-btn').addEventListener('click',()=>{this.addRecipe()});
        document.getElementById('youtube-url').addEventListener('keypress',(e)=>{if(e.key==='Enter'){this.addRecipe()}});
        document.getElementById('search-input').addEventListener('input',(e)=>{this.searchRecipes(e.target.value)});
      }
      async addRecipe(){
        const urlInput=document.getElementById('youtube-url');
        const addBtn=document.getElementById('add-btn');
        const loading=document.getElementById('loading');
        const url=urlInput.value.trim();
        if(!url){alert('유튜브 링크를 입력해주세요.');return;}
        if(!this.isValidYouTubeUrl(url)){alert('올바른 유튜브 링크가 아닙니다.');return;}
        if(this.recipes.some(r=>r.url===url)){alert('이미 저장된 레시피입니다.');return;}
        addBtn.disabled=true;loading.style.display='block';
        try{
          const title=await this.extractTitle(url);
          const videoId=this.extractVideoId(url);
          const thumbnail=`https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
          const recipe={id:Date.now().toString(),title:title||'제목을 가져올 수 없습니다',url,thumbnail,createdAt:new Date().toISOString()};
          this.recipes.unshift(recipe);
          this.saveRecipes();
          this.renderRecipes();
          this.updateStats();
          urlInput.value='';
          alert('레시피가 저장되었습니다! 🎉');
        }catch(err){
          console.error(err);
          alert('제목을 가져오는데 실패했습니다. 다시 시도해주세요.');
        }finally{
          addBtn.disabled=false;loading.style.display='none';
        }
      }
      isValidYouTubeUrl(url){
        const patterns=[/^https?:\/\/(www\.)?youtube\.com\/shorts\/[\w-]+/,/^https?:\/\/(www\.)?youtube\.com\/watch\?v=[\w-]+/,/^https?:\/\/youtu\.be\/[\w-]+/];
        return patterns.some(p=>p.test(url));
      }
      extractVideoId(url){
        const patterns=[/(?:youtube\.com\/shorts\/)([a-zA-Z0-9_-]+)/,/(?:youtube\.com\/watch\?v=)([a-zA-Z0-9_-]+)/,/(?:youtu\.be\/)([a-zA-Z0-9_-]+)/];
        for(const p of patterns){const m=url.match(p);if(m)return m[1];}
        return null;
      }
      async extractTitle(url){
        try{
          const id=this.extractVideoId(url);
          if(!id) throw new Error('Invalid video ID');
          const res=await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`);
          if(!res.ok) throw new Error('oEmbed fetch failed');
          const data=await res.json();
          return data.title;
        }catch(_){
          const id=this.extractVideoId(url);
          return `유튜브 레시피 (${id||'알 수 없음'})`;
        }
      }
      deleteRecipe(id){
        if(confirm('정말 이 레시피를 삭제하시겠습니까?')){
          this.recipes=this.recipes.filter(r=>r.id!==id);
          this.saveRecipes();this.renderRecipes();this.updateStats();
        }
      }
      searchRecipes(q){this.renderRecipes(q);}
      renderRecipes(searchQuery=''){
        let list=this.recipes;
        if(searchQuery){const q=searchQuery.toLowerCase();list=this.recipes.filter(r=>r.title.toLowerCase().includes(q));}
        const container=document.getElementById('recipes-grid');
        const noResults=document.getElementById('no-results');
        if(list.length===0){
          container.style.display='none';noResults.style.display='block';
          noResults.innerHTML=searchQuery?`"${searchQuery}"에 대한 검색 결과가 없습니다.<br>다른 키워드로 검색해보세요.`:'아직 저장된 레시피가 없습니다.<br>위에서 유튜브 링크를 추가해보세요! 🎬';
        }else{
          container.style.display='grid';noResults.style.display='none';
          container.innerHTML=list.map(r=>this.createRecipeCard(r)).join('');
        }
      }
      createRecipeCard(r){
        const date=new Date(r.createdAt).toLocaleDateString('ko-KR');
        const id=this.extractVideoId(r.url) || '';
        return `
          <div class="recipe-card">
            <div class="recipe-thumbnail">
              <img src="${r.thumbnail}" alt="${r.title}"
                onerror="this.onerror=null; this.src='https://img.youtube.com/vi/${id}/hqdefault.jpg';">
              <div class="play-overlay" onclick="window.open('${r.url}','_blank')">▶</div>
            </div>
            <div class="recipe-content">
              <h3 class="recipe-title" title="${r.title}">${r.title}</h3>
              <div class="recipe-date">저장일: ${date}</div>
              <div class="recipe-actions">
                <a href="${r.url}" target="_blank" class="watch-btn">🎬 시청하기</a>
                <button class="delete-btn" onclick="app.deleteRecipe('${r.id}')" title="삭제">🗑️</button>
              </div>
            </div>
          </div>`;
      }
      updateStats(){
        const total=this.recipes.length;
        const today=new Date().toDateString();
        const todayCount=this.recipes.filter(r=>new Date(r.createdAt).toDateString()===today).length;
        document.getElementById('total-count').textContent=total;
        document.getElementById('today-count').textContent=todayCount;
      }
      loadRecipes(){
        try{const s=localStorage.getItem('youtubeRecipes');return s?JSON.parse(s):[]}catch{return []}
      }
      saveRecipes(){
        try{localStorage.setItem('youtubeRecipes',JSON.stringify(this.recipes));}catch(e){console.error('저장 중 오류:',e);}
      }
      setupPWA(){
        let deferredPrompt;
        const prompt=document.getElementById('install-prompt');
        const btn=document.getElementById('install-btn');
        window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;prompt.style.display='flex';});
        btn.addEventListener('click',async()=>{if(deferredPrompt){deferredPrompt.prompt();await deferredPrompt.userChoice;deferredPrompt=null;prompt.style.display='none';}});
        window.addEventListener('appinstalled',()=>{prompt.style.display='none';});
        if('serviceWorker' in navigator){
          window.addEventListener('load',()=>{
            navigator.serviceWorker.register('sw.js').then(reg=>{console.log('SW registered',reg);}).catch(err=>{console.log('SW registration failed',err);});
          });
        }
      }
    }
    const app=new YouTubeRecipeApp();
  </script>
</body>
</html>
